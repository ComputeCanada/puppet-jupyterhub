#!/bin/bash
VENV="/dev/shm/jupyter"
rm -rf $VENV
mkdir -p $VENV
PYTHON="<%= $python_path %>"
$PYTHON -m virtualenv $VENV
source $VENV/bin/activate
pip install ipykernel
deactivate

# Create deployable environment tarball
$PYTHON -m virtualenv --relocatable $VENV
sed -i 's;VIRTUAL_ENV=.*;VIRTUAL_ENV=$(readlink -f $(dirname $BASH_SOURCE)/..);g' $VENV/bin/activate
tar czf <%= $tarball_path %> --directory=$VENV/.. jupyter
rm -rf $VENV
